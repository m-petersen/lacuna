# Lacuna Configuration File
# =========================
# Copy this file and modify for your analysis.
# Pass to lacuna with: lacuna --config my_config.yaml
#
# Generate this template: lacuna --generate-config > my_config.yaml
#
# This config uses the EXTENSIBLE FORMAT with:
#   - connectomes: section for registering connectome resources with explicit space
#   - analyses: section for configuring any analysis from the registry

# =============================================================================
# MASK SPACE CONFIGURATION
# =============================================================================
# The coordinate space of your input mask images.
# Required if not detectable from filename (e.g., _space-MNI152NLin6Asym_)
# or sidecar JSON.
#
# Common spaces:
#   - MNI152NLin6Asym (FSL's MNI template)
#   - MNI152NLin2009cAsym (fMRIPrep default)
#
# Resolution is automatically detected from image voxel size.

mask_space: MNI152NLin6Asym

# =============================================================================
# SUBJECT FILTERING (for BIDS datasets)
# =============================================================================

# Subject IDs to process (without 'sub-' prefix)
# Empty list = process all subjects
subjects: []
  # - "001"
  # - "002"

# Session IDs to process (without 'ses-' prefix)
# Empty list = process all sessions
sessions: []
  # - "01"

# Glob pattern to filter mask files
# Examples: "*label-WMH*", "*label-lesion*", "*acuteinfarct*"
pattern: null

# =============================================================================
# CONNECTOMES SECTION
# =============================================================================
# Register connectome resources with explicit space information.
# If not downloaded yet see: lacuna fetch --help
#
# Supported types:
#   - functional: HDF5 file or directory with batched files (auto-detected)
#   - structural: .tck tractogram file (auto-detected from extension)

connectomes:


  # Example functional connectome (GSP1000)
  # functional:
  #   path: /path/to/gsp1000_connectome.h5
  #   space: MNI152NLin6Asym
  #   resolution: 2  # Optional, auto-detected from file if not provided

  # Example structural connectome (dTOR)
  # structural:
  #   path: /path/to/dTOR.tck
  #   space: MNI152NLin2009cAsym

# =============================================================================
# ANALYSES SECTION
# =============================================================================
# Configure analyses using names from the analysis registry.
# Any analysis registered with BaseAnalysis can be configured here.
#
# Available analyses (use lacuna --list-analyses to see all):
#   - RegionalDamage: Quantifies lesion overlap with brain parcellations
#   - FunctionalNetworkMapping: Maps functional connectivity disruption
#   - StructuralNetworkMapping: Maps white matter disconnection
#   - ParcelAggregation: Aggregates voxel-wise maps to parcellation ROIs

analyses:
  # RegionalDamage: Quantifies lesion overlap with brain parcellations
  RegionalDamage:
    parcel_names:
      - Schaefer2018_100Parcels7Networks


  # FunctionalNetworkMapping: Maps functional connectivity disruption
  # Uncomment and provide a connectome reference to enable
  # FunctionalNetworkMapping:
  #   connectome: functional  # Reference to connectomes section
  #   method: boes  # "boes" (mean) or "pini" (PCA-based)
  #   pini_percentile: 20  # For PINI method only
  #   compute_p_map: true  # Compute p-value map (two-tailed)
  #   fdr_alpha: 0.05  # FDR correction alpha level (null to disable)
  #   # t_threshold: 9.0  # Optional threshold for binary mask
  #   return_in_input_space: true  # Transform outputs to input mask space
  #   output_resolution: null  # Output resolution in mm (1 or 2). null = match input

  # StructuralNetworkMapping: Maps white matter disconnection
  # Requires MRtrix3 installation
  # Uncomment and provide a connectome reference to enable
  # StructuralNetworkMapping:
  #   connectome: structural  # Reference to connectomes section
  #   output_resolution: 2  # Output resolution in mm (1 or 2) for TDI and final outputs
  #   cache_tdi: true # Cache TDI maps to speed up repeated analyses
  #   n_jobs: 1 # Number of parallel processes for MRtrix commands (-1 = all CPUs; separate from nprocs)
  #   keep_intermediate: false  # Include intermediate results (lesion tractogram, TDI)
  #   cleanup_temp_files: true  # Delete temp working directory after analysis
  #   return_in_input_space: true  # Transform outputs to input mask space
  #   # parcellation_name: Schaefer2018_100Parcels7Networks
  #   # compute_disconnectivity_matrix: false
  #   # show_mrtrix_output: false

  # ParcelAggregation: Aggregate voxel-wise maps to parcellation ROIs
  # Uncomment to enable aggregation of network mapping outputs
  # ParcelAggregation:
  #   source:
  #     FunctionalNetworkMapping:
  #       - rmap
  #       - tmap
  #       - zmap
  #       - pmap
  #       - pfdrmap
  #       - pfdrthresholdmap  # Binary mask of FDR-significant voxels
  #     StructuralNetworkMapping: 
  #       - disconnection_map
  #   aggregation: mean  # mean, sum, percent, volume, median, std
  #   parcel_names:
  #     - Schaefer2018_100Parcels7Networks

# =============================================================================
# PATHS AND CACHING
# =============================================================================
# Base cache directory for downloads, transforms, and intermediate files.
# Defaults to ~/.cache/lacuna (Linux/macOS).
# Can also be set via LACUNA_CACHE_DIR environment variable.
cache_dir: null

# Temporary directory for intermediate files during analysis.
# Defaults to cache_dir/tmp. For HPC environments, you may want to set this
# to fast local scratch storage (e.g., /scratch/$USER/lacuna_tmp).
# Can also be set via LACUNA_TMP_DIR environment variable.
tmp_dir: null

# =============================================================================
# PERFORMANCE OPTIONS
# =============================================================================
# Number of parallel processes (-1 = all CPUs, default)
# Controls how many masks are processed simultaneously for parallel analyses
# (RegionalDamage, ParcelAggregation, StructuralNetworkMapping)
nprocs: -1

# Batch size: how many masks to process together (-1 = all, default)
# Controls memory usage for vectorized analyses (FunctionalNetworkMapping).
# Use -1 for fastest processing (all masks at once, highest memory).
# Use lower values (e.g., 10-50) to reduce peak memory usage.
batch_size: -1

# =============================================================================
# LOGGING
# =============================================================================
# Enable verbose output (true/false)
verbose: false
